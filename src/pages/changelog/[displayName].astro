---
import Layout from "@layouts/Layout.astro";
import VerticalStepper from "@components/vertical-stepper";
import { GetCurrentChangelog } from "src/changelog";

const { displayName } = Astro.params;

const project = GetCurrentChangelog(Astro.locals, displayName);
Astro.locals.project = project;

const changelogDate = (date: Date): string => {
    // Creates a range where date is the beginning of the week, and the end of the week is 6 days later. If the end of the week has not happened, replace it with current
    const startOfWeek = new Date(
        date.getFullYear(),
        date.getMonth(),
        date.getDate() - date.getDay(),
    );
    const endOfWeek = new Date(
        date.getFullYear(),
        date.getMonth(),
        date.getDate() + (6 - date.getDay()),
    );
    const currentDate = new Date();

    if (endOfWeek > currentDate) {
        return `Current - ${startOfWeek.toLocaleDateString()}`;
    }

    return `${endOfWeek.toLocaleDateString()} - ${startOfWeek.toLocaleDateString()}`;
};

const generated = project.changelog.map((cl) => [
    changelogDate(cl.week),
    ...cl.generated,
]);
---

<Layout
    title="Autumn-cl"
    desc="Autogenerated changelogs!"
>
    <VerticalStepper generated={generated} />
</Layout>
